// Generated by Copilot
// Main App component for Module 1: React Basics - Final Integration
// Kompletna aplikacja do zarzÄ…dzania filmami z peÅ‚nÄ… funkcjonalnoÅ›ciÄ…
import { useState, useEffect } from 'react';
import { Movie, CreateMovieData } from '@/types/Movie';
import { MovieList, MovieDetail, AddMovieForm, MovieSearch, SearchAndSortOptions } from '@/components';
import { useMovies } from '@/hooks';

function App() {
  // Stan wybranego filmu i widoku
  const [selectedMovie, setSelectedMovie] = useState<Movie | null>(null);
  const [currentView, setCurrentView] = useState<'list' | 'detail' | 'add'>('list');
  
  // Stan dla przefiltrowanych filmÃ³w
  const [filteredMovies, setFilteredMovies] = useState<Movie[]>([]);
  const [searchOptions, setSearchOptions] = useState<SearchAndSortOptions | null>(null);
  
  // Stan dla powiadomieÅ„ i UX
  const [notification, setNotification] = useState<{
    message: string;
    type: 'success' | 'error' | 'info';
  } | null>(null);
  const [isTransitioning, setIsTransitioning] = useState(false);

  // UÅ¼ycie custom hook do zarzÄ…dzania filmami
  const { 
    movies, 
    loading, 
    error, 
    refreshMovies,
    addMovie 
  } = useMovies();

  // Funkcja pokazywania powiadomieÅ„
  const showNotification = (message: string, type: 'success' | 'error' | 'info') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 4000); // Auto-hide po 4 sekundach
  };

  // Funkcja obsÅ‚ugi klikniÄ™cia w film z pÅ‚ynnym przejÅ›ciem
  const handleMovieClick = (movie: Movie) => {
    setIsTransitioning(true);
    setTimeout(() => {
      setSelectedMovie(movie);
      setCurrentView('detail');
      setIsTransitioning(false);
    }, 150);
  };

  // Funkcja powrotu do listy z pÅ‚ynnym przejÅ›ciem
  const handleBackToList = () => {
    setIsTransitioning(true);
    setTimeout(() => {
      setCurrentView('list');
      setSelectedMovie(null);
      setIsTransitioning(false);
    }, 150);
  };

  // Funkcja przejÅ›cia do formularza dodawania filmu
  const handleShowAddForm = () => {
    setIsTransitioning(true);
    setTimeout(() => {
      setCurrentView('add');
      setSelectedMovie(null);
      setIsTransitioning(false);
    }, 150);
  };

  // Funkcja obsÅ‚ugi dodawania nowego filmu z powiadomieniem
  const handleAddMovie = async (movieData: CreateMovieData) => {
    try {
      await addMovie(movieData);
      showNotification(`âœ… Film "${movieData.title}" zostaÅ‚ dodany pomyÅ›lnie!`, 'success');
      setCurrentView('list'); // PowrÃ³t do listy po dodaniu
    } catch (error) {
      showNotification(`âŒ BÅ‚Ä…d podczas dodawania filmu: ${error}`, 'error');
    }
  };

  // Funkcje obsÅ‚ugi wyszukiwania i filtrowania
  const handleFilteredMoviesChange = (filtered: Movie[]) => {
    setFilteredMovies(filtered);
  };

  const handleSearchOptionsChange = (options: SearchAndSortOptions) => {
    setSearchOptions(options);
  };

  // Inicjalizacja przefiltrowanych filmÃ³w przy pierwszym zaÅ‚adowaniu
  useEffect(() => {
    if (movies.length > 0 && filteredMovies.length === 0 && !searchOptions?.searchQuery) {
      setFilteredMovies(movies);
    }
  }, [movies, filteredMovies.length, searchOptions?.searchQuery]);

  // OkreÅ›lenie, ktÃ³re filmy wyÅ›wietliÄ‡
  const moviesToDisplay = filteredMovies.length > 0 || searchOptions?.searchQuery 
    ? filteredMovies 
    : movies;

  // Funkcja okreÅ›lajÄ…ca tytuÅ‚ strony na podstawie aktualnego widoku
  const getPageTitle = () => {
    switch (currentView) {
      case 'detail':
        return selectedMovie ? `ğŸ¬ ${selectedMovie.title}` : 'ğŸ¬ SzczegÃ³Å‚y filmu';
      case 'add':
        return 'â• Dodaj nowy film';
      default:
        return 'ğŸ¬ Kolekcja filmÃ³w';
    }
  };

  // Statystyki aplikacji
  const appStats = {
    totalMovies: movies.length,
    filteredMovies: moviesToDisplay.length,
    hasActiveSearch: Boolean(searchOptions?.searchQuery),
    currentSort: searchOptions?.sortBy || 'title'
  };

  return (
    <div className={`app ${isTransitioning ? 'transitioning' : ''}`}>
      {/* Notification Toast */}
      {notification && (
        <div className={`notification notification-${notification.type}`}>
          <span>{notification.message}</span>
          <button 
            onClick={() => setNotification(null)}
            className="notification-close"
          >
            âœ•
          </button>
        </div>
      )}

      <header className="app-header">
        <div className="header-content">
          <h1>{getPageTitle()}</h1>
          <p>Module 1: React Basics - Kompletna aplikacja filmowa</p>
          
          {/* App Statistics */}
          <div className="app-stats">
            <span className="stat">
              ğŸ“Š {appStats.totalMovies} {appStats.totalMovies === 1 ? 'film' : 'filmÃ³w'}
            </span>
            {appStats.hasActiveSearch && (
              <span className="stat">
                ğŸ” {appStats.filteredMovies} wynikÃ³w
              </span>
            )}
            <span className="stat">
              ğŸ“ˆ Sortowanie: {appStats.currentSort}
            </span>
          </div>
        </div>
        
        <nav className="app-navigation">
          {currentView === 'list' ? (
            <button 
              className="add-movie-button"
              onClick={handleShowAddForm}
              disabled={loading}
            >
              â• Dodaj nowy film
            </button>
          ) : (
            <button 
              className="back-button"
              onClick={handleBackToList}
            >
              â† PowrÃ³t do listy filmÃ³w
            </button>
          )}
        </nav>
      </header>
      
      <main className="app-main">
        {currentView === 'list' ? (
          <section className="movie-section">
            {loading ? (
              <div className="loading-state">
                <h2>â³ Åadowanie filmÃ³w...</h2>
                <p>ProszÄ™ czekaÄ‡, pobieramy dane o filmach.</p>
              </div>
            ) : error ? (
              <div className="error-state">
                <h2>âŒ WystÄ…piÅ‚ bÅ‚Ä…d</h2>
                <p>{error}</p>
                <button 
                  className="refresh-button"
                  onClick={refreshMovies}
                >
                  ğŸ”„ SprÃ³buj ponownie
                </button>
              </div>
            ) : (
              <>
                <MovieSearch
                  movies={movies}
                  onFilteredMoviesChange={handleFilteredMoviesChange}
                  onOptionsChange={handleSearchOptionsChange}
                />
                <MovieList 
                  movies={moviesToDisplay}
                  onMovieClick={handleMovieClick}
                />
              </>
            )}
          </section>
        ) : currentView === 'detail' ? (
          <section className="movie-detail-section">
            <MovieDetail movie={selectedMovie} />
          </section>
        ) : currentView === 'add' ? (
          <section className="add-movie-section">
            <AddMovieForm 
              onSubmit={handleAddMovie}
              onCancel={handleBackToList}
              isLoading={loading}
            />
          </section>
        ) : null}
      </main>

      {/* App Footer */}
      <footer className="app-footer">
        <div className="footer-content">
          <div className="footer-section">
            <h4>ğŸ¬ Movie Management App</h4>
            <p>Kompletna aplikacja do zarzÄ…dzania kolekcjÄ… filmÃ³w</p>
          </div>
          
          <div className="footer-section">
            <h4>ğŸš€ Funkcje</h4>
            <ul>
              <li>âœ… PrzeglÄ…danie filmÃ³w</li>
              <li>âœ… SzczegÃ³Å‚owe informacje</li>
              <li>âœ… Dodawanie nowych filmÃ³w</li>
              <li>âœ… Wyszukiwanie i sortowanie</li>
            </ul>
          </div>
          
          <div className="footer-section">
            <h4>ğŸ› ï¸ Technologie</h4>
            <ul>
              <li>React 18 + TypeScript</li>
              <li>GitHub Copilot</li>
              <li>Vite Build Tool</li>
              <li>CSS3 + Responsive Design</li>
            </ul>
          </div>
        </div>
        
        <div className="footer-bottom">
          <p>Â© 2025 Movie Management App â€¢ Stworzone z â¤ï¸ i GitHub Copilot</p>
          <p>Module 1: React Basics - Phase 8 Complete! ğŸ‰</p>
        </div>
      </footer>
    </div>
  );
}

export default App;