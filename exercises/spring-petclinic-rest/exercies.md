# Spring Petclinic REST — GitHub Copilot Exercises

<!-- Generated by Copilot -->

This set of exercises will help you learn how to use GitHub Copilot to build features in the Spring Petclinic REST project. Each exercise includes a goal, hints for Copilot prompts, and a success criteria. Work through them in order or pick what’s most useful.

Notes:
- Use Copilot inline completions and Chat to generate code, tests, and docs.
- Keep code readable, typed, and consistent with existing style.
- Prefer small steps: generate stubs, then iterate.

## 1) Add an endpoint: List pets by owner ID
- Goal: Create `GET /api/owners/{ownerId}/pets` endpoint that returns a list of pets for a given owner.
- Where: `rest/controller`, `service`, `repository` layers. Reuse or extend `PetRepository`.
- Copilot prompts:
  - "Create an endpoint in PetController to list pets by ownerId using PetRepository"
  - "Map entities to DTOs using existing mappers"
- Success: Endpoint returns 200 + JSON array with pet info; add unit test.

## 2) Add an endpoint: Create a visit with validation
- Goal: `POST /api/visits` to create a visit. Validate that `petId` exists and `visitDate` is not in the past.
- Where: `VisitController`, `VisitService`, `VisitRepository`.
- Copilot prompts: "Add POST endpoint with @Valid and custom validator for VisitDTO".
- Success: Returns 201 with persisted visit; invalid requests return 400 with errors.

## 3) Pagination and sorting for vets
- Goal: Implement `GET /api/vets?page=&size=&sort=` with pagination and sorting.
- Where: `VetRepository` (Spring Data paging), controller, service.
- Copilot prompts: "Add pageable and sort to vets endpoint using Page<Vet>".
- Success: Returns paginated result with total elements and pages.

## 4) Add a new table: Insurance provider
- Goal: Create an `InsuranceProvider` entity/table with fields: id, name, phone, policyUrl; relate to `Owner` (optional one-to-many).
- Where: `model`, `repository`, `service`, migration scripts in `resources/db/*`.
- Copilot prompts: "Generate JPA entity and repository for InsuranceProvider".
- Success: Database schema updated; CRUD endpoints working.

## 5) Add a new table: Pet appointment
- Goal: Create `Appointment` entity/table with fields: id, petId, vetId, startTime, endTime, status.
- Where: `model`, `repository`, `service`, endpoints.
- Copilot prompts: "Create JPA entity Appointment with relations to Pet and Vet and a REST controller".
- Success: Can create/update/cancel appointments; conflicts are prevented by business rules.

## 6) Business logic: Prevent overlapping appointments
- Goal: In `AppointmentService`, add logic to reject creation when a vet has an overlapping appointment.
- Copilot prompts: "Implement overlap check with a repository query (start < existingEnd AND end > existingStart)".
- Success: Returns 409 Conflict when overlap; happy path returns 201.

## 7) Input validation for owners
- Goal: Add bean validation to `Owner` DTOs: email format, phone pattern, non-empty name.
- Copilot prompts: "Annotate Owner DTO with validation constraints and hook into controller with @Valid".
- Success: Invalid inputs return 400 with useful messages; tests cover validation failures.

## 8) Global error handling and problem responses
- Goal: Improve global `@ControllerAdvice` to return RFC7807-style problem details.
- Where: `rest/advice`.
- Copilot prompts: "Implement global exception handler returning application/problem+json with details".
- Success: Consistent error payloads across endpoints.

## 10) Swagger/OpenAPI enhancements
Goal: Document new endpoints, parameters, and schemas in `resources/openapi.yml` and annotations.
Copilot prompts: "Update OpenAPI spec for appointments and insurance providers".
Success: Swagger UI shows the new endpoints with examples.

## 11) Edit pom.xml: Add a dependency or plugin
- Goal: Add a new Maven dependency (e.g., Lombok, MapStruct, or a test library) or a Maven plugin (e.g., JaCoCo for code coverage) to `pom.xml`.
- Where: `pom.xml` in the project root.
- Copilot prompts:
  - "Add the Lombok dependency to pom.xml with the correct scope"
  - "Add the JaCoCo Maven plugin for code coverage reports"
- Success: Dependency or plugin is added, `mvnw.cmd compile` or `mvnw.cmd test` works, and the new tool is available.

## 12) Create a CI/CD pipeline
- Goal: Set up a basic CI/CD pipeline for the project using GitHub Actions or Azure Pipelines. The pipeline should build the project, run tests, and (optionally) build a Docker image.
- Where: `.github/workflows/` or `azure-pipelines.yml` at the project root.
- Copilot prompts:
  - "Generate a GitHub Actions workflow for Maven build and test on push and PR"
  - "Create an Azure Pipelines YAML to build, test, and publish Docker image"
- Success: Pipeline runs on push/PR, shows build/test results, and (optionally) publishes a Docker image artifact.



- Success: Image builds and runs locally.
mvnw.cmd -q -DskipTests package
docker build -t petclinic-rest:local .
docker run --rm -p 9966:9966 petclinic-rest:local


## 13) Add docker-compose for app + database
- Goal: Create `docker-compose.yml` to run the app with MySQL or Postgres.
- Copilot prompts: "Compose file with app service, DB service, healthchecks, env vars, volumes".
- Success: `docker-compose up` starts both and the app connects to the DB.

## 14) Caching frequently-read resources
- Goal: Add Spring Cache (e.g., caffeine) to cache `PetType` and `Specialty` reads.
- Where: `config`, annotate service methods.
- Copilot prompts: "Enable caching and add @Cacheable to pet type lookup".
- Success: Cache hit logs visible; add a small benchmark or test.

## 15) Logging and trace ID
- Goal: Configure logging to include a correlation ID (MDC) and propagate via headers.
- Where: `security` or a filter; `logback.xml` updates.
- Copilot prompts: "Add OncePerRequestFilter to inject/propagate X-Correlation-ID into MDC".
- Success: Logs include correlation ID per request.

## 16) Security: Role-based access for admin endpoints
- Goal: Restrict appointment management endpoints to `ROLE_ADMIN` and vet endpoints to `ROLE_VET`.
- Where: `security` config.
- Copilot prompts: "Add method security and @PreAuthorize annotations".
- Success: Unauthorized users get 403; authorized users pass.


## 18) API testing and documentation with Postman
- Goal: Use Postman to test the REST API endpoints, automate test scenarios, and generate API documentation.
- Where: Use or update the provided Postman collection in `test/postman/`, or create a new one.
- Copilot prompts:
  - "Import the OpenAPI spec into Postman and generate a collection"
  - "Write Postman tests for creating, updating, and deleting pets and owners"
  - "Export a Postman collection and share it with your team"
  - "Generate API documentation from a Postman collection"
- Success: Postman collection covers key endpoints (CRUD for pets, owners, visits, etc.), includes automated tests, and can be exported or used to generate docs.

---

### Extra Copilot Tips
- Ask Copilot to scaffold DTOs, mappers, and repositories consistent with existing patterns.
- Generate a minimal PR description for each exercise and a changelog entry.
- Request example curl commands or Postman snippets for new endpoints.
- Use Copilot to create database migration scripts for H2/MySQL/Postgres in `resources/db/*`.

### Verification
- Build: `mvnw.cmd -q -DskipTests package`
- Tests: `mvnw.cmd -q test`
- Swagger: check `openapi.yml` and any `@Operation` annotations.
- Run: `java -jar target/*.jar` or Docker image.

Happy building with Copilot!
